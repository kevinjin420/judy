<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Judy AI Companion</title>
<style>
    html, body { margin:0; padding:0; height:100vh; font-family:var(--vscode-font-family); background-color:var(--vscode-editor-background); color:var(--vscode-foreground);}
    .container { display:flex; flex-direction:column; height:100%; padding:10px; gap:8px;}
    #messages { flex:1; overflow-y:auto; border:1px solid var(--vscode-foreground); padding:8px; border-radius:4px;}
    input, button { padding:6px 10px; font-size:13px;}
    audio { margin-top:5px;}
</style>
</head>
<body>
<div class="container">
    <div id="messages"></div>
    <input type="text" id="userInput" placeholder="Type your message..." />
    <button id="sendBtn">Send</button>
    <audio id="aiAudio" autoplay></audio>
</div>

<script>
const vscode = acquireVsCodeApi();
const sendBtn = document.getElementById('sendBtn');
const userInput = document.getElementById('userInput');
const messagesDiv = document.getElementById('messages');
const aiAudio = document.getElementById('aiAudio');

sendBtn.onclick = () => {
    const text = userInput.value.trim();
    if (!text) return;
    messagesDiv.innerHTML += `<div><b>You:</b> ${text}</div>`;
    userInput.value = '';
    vscode.postMessage({ command: 'sendText', text });
};

window.addEventListener('message', event => {
    const message = event.data;
    if (message.command === 'playAudio') {
        messagesDiv.innerHTML += `<div><b>Judy:</b> ${message.text}</div>`;
        aiAudio.src = 'data:audio/wav;base64,' + message.audioBase64;
        aiAudio.play();
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
});
</script>
</body>
</html>
